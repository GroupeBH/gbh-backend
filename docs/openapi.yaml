openapi: 3.0.3
info:
  title: GBH Backend API
  version: 1.4.0
  description: API REST JSON pour Groupe B-Holding Sarl (GBH).
servers:
  - url: http://localhost:8080
paths:
  /api/services:
    get:
      summary: Lister les services
      responses:
        "200":
          description: Liste des services
          content:
            application/json:
              schema:
                type: object
                properties:
                  services:
                    type: array
                    items:
                      $ref: '#/components/schemas/Service'
    post:
      summary: Créer un service (admin)
      security:
        - AdminKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminService'
      responses:
        "201":
          description: Service créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
  /api/services/{id}:
    put:
      summary: Mettre à jour un service (admin)
      security:
        - AdminKey: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminService'
      responses:
        "200":
          description: Service mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
  /api/services/{id}/availability:
    get:
      summary: Disponibilités par service et date
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: query
          name: date
          required: true
          schema:
            type: string
            example: 2026-02-04
        - in: query
          name: duration
          required: false
          schema:
            type: integer
            example: 30
      responses:
        "200":
          description: Liste des créneaux disponibles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Availability'
        "400":
          description: Requête invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "404":
          description: Service non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/services/{id}/testimonials:
    get:
      summary: Lister les témoignages d'un service
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Liste des témoignages
          content:
            application/json:
              schema:
                type: object
                properties:
                  testimonials:
                    type: array
                    items:
                      $ref: '#/components/schemas/ServiceTestimonial'
        "404":
          description: Service non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Ajouter un témoignage pour un service
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServiceTestimonialCreate'
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "201":
          description: Témoignage créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServiceTestimonial'
        "400":
          description: Requête invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "404":
          description: Service non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/availability:
    get:
      summary: Disponibilités par date
      parameters:
        - in: query
          name: date
          required: true
          schema:
            type: string
            example: 2026-02-04
        - in: query
          name: duration
          required: false
          schema:
            type: integer
            example: 30
      responses:
        "200":
          description: Liste des créneaux disponibles
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Availability'
        "400":
          description: Requête invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/availability/next:
    get:
      summary: Prochain créneau disponible
      parameters:
        - in: query
          name: from
          required: false
          schema:
            type: string
            example: 2026-02-04
        - in: query
          name: duration
          required: false
          schema:
            type: integer
            example: 30
      responses:
        "200":
          description: Prochain créneau
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NextAvailability'
        "404":
          description: Aucun créneau trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/appointments:
    post:
      summary: Créer un rendez-vous
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppointmentCreate'
      responses:
        "201":
          description: Rendez-vous créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppointmentCreateResponse'
        "409":
          description: Créneau déjà réservé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/appointments/{id}:
    get:
      summary: Détails d'un rendez-vous
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Rendez-vous
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Appointment'
        "404":
          description: Non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/appointments/lookup:
    post:
      summary: Récupérer un rendez-vous via un ID saisi
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AppointmentLookup'
      responses:
        "200":
          description: Rendez-vous
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Appointment'
        "404":
          description: Non trouvé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/contact:
    post:
      summary: Envoyer un message de contact
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ContactCreate'
      responses:
        "201":
          description: Message reçu
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContactMessage'
  /api/payments/intent:
    post:
      summary: Simuler une intention de paiement
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentIntentRequest'
      responses:
        "200":
          description: Intention de paiement simulée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'
  /api/admin/register:
    post:
      summary: Inscription admin (clé de bootstrap)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminRegister'
      responses:
        "201":
          description: Inscription et session admin créées
          headers:
            Set-Cookie:
              schema:
                type: string
              description: Cookies gbh_access et gbh_refresh
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminAuthResponse'
        "401":
          description: Clé de bootstrap invalide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "409":
          description: Doublon username/email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        "503":
          description: Auth admin non configurée
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/admin/login:
    post:
      summary: Login admin (cookies JWT)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminLogin'
      responses:
        "200":
          description: Login OK
          headers:
            Set-Cookie:
              schema:
                type: string
              description: Cookies gbh_access et gbh_refresh
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminAuthResponse'
  /api/admin/refresh:
    post:
      summary: Refresh admin (cookies JWT)
      responses:
        "200":
          description: Refresh OK
          headers:
            Set-Cookie:
              schema:
                type: string
              description: Cookies gbh_access et gbh_refresh
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminAuthResponse'
  /api/admin/logout:
    post:
      summary: Logout admin (cookies JWT)
      responses:
        "200":
          description: Logout OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminAuthResponse'
  /api/admin/services:
    post:
      summary: Créer un service (admin)
      security:
        - AdminKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminService'
      responses:
        "201":
          description: Service créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
  /api/admin/services/{id}:
    put:
      summary: Mettre à jour un service (admin)
      security:
        - AdminKey: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminService'
      responses:
        "200":
          description: Service mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Service'
    delete:
      summary: Supprimer un service (admin)
      security:
        - AdminKey: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Suppression OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
  /api/admin/blocks:
    post:
      summary: Créer un blocage de créneau (admin)
      security:
        - AdminKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminBlock'
      responses:
        "201":
          description: Blocage créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReservationBlock'
  /api/admin/blocks/{id}:
    delete:
      summary: Supprimer un blocage (admin)
      security:
        - AdminKey: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Suppression OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
  /api/admin/users:
    post:
      summary: Créer un utilisateur admin
      security:
        - AdminKey: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserCreate'
      responses:
        "201":
          description: Utilisateur créé
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        "409":
          description: Doublon username/email
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /api/admin/users/{id}/password:
    patch:
      summary: Changer le mot de passe d'un admin
      security:
        - AdminKey: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserPassword'
      responses:
        "200":
          description: Mot de passe mis à jour
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
  /api/admin/appointments:
    get:
      summary: Lister les rendez-vous (admin)
      security:
        - AdminKey: []
      parameters:
        - in: query
          name: date
          required: false
          schema:
            type: string
            example: 2026-02-04
      responses:
        "200":
          description: Liste des rendez-vous
          content:
            application/json:
              schema:
                type: object
                properties:
                  appointments:
                    type: array
                    items:
                      $ref: '#/components/schemas/Appointment'
  /api/admin/appointments/{id}/status:
    patch:
      summary: Changer le statut d'un rendez-vous (admin)
      security:
        - AdminKey: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminStatus'
      responses:
        "200":
          description: Statut mis à jour
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Appointment'
  /api/admin/contacts:
    get:
      summary: Lister les messages de contact (admin)
      security:
        - AdminKey: []
      responses:
        "200":
          description: Liste des messages
          content:
            application/json:
              schema:
                type: object
                properties:
                  contacts:
                    type: array
                    items:
                      $ref: '#/components/schemas/ContactMessage'
components:
  securitySchemes:
    AdminKey:
      type: apiKey
      in: header
      name: X-Admin-Key
  schemas:
    Service:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        shortDescription:
          type: string
        description:
          type: string
        benefits:
          type: array
          items:
            type: string
        category:
          type: string
        forAudience:
          type: string
        slug:
          type: string
        createdAt:
          type: string
          format: date-time
    Availability:
      type: object
      properties:
        serviceId:
          type: string
        date:
          type: string
        timezone:
          type: string
        duration:
          type: integer
        slots:
          type: array
          items:
            type: string
            example: 09:00
    NextAvailability:
      type: object
      properties:
        date:
          type: string
        time:
          type: string
        timezone:
          type: string
        duration:
          type: integer
    AppointmentCreateResponse:
      type: object
      properties:
        appointment:
          $ref: '#/components/schemas/Appointment'
        availableSlots:
          type: array
          items:
            type: string
    AppointmentCreate:
      type: object
      required:
        - serviceId
        - name
        - email
        - phone
        - type
        - date
        - time
        - paymentMethod
      properties:
        serviceId:
          type: string
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        type:
          type: string
          enum: [online, presentiel]
        date:
          type: string
          example: 2026-02-04
        time:
          type: string
          example: 14:45
        duration:
          type: integer
          example: 30
        paymentMethod:
          type: string
          enum: [online, place]
        price:
          type: integer
          example: 15000
    Appointment:
      type: object
      properties:
        id:
          type: string
        serviceId:
          type: string
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        type:
          type: string
        date:
          type: string
        time:
          type: string
        duration:
          type: integer
          example: 45
        price:
          type: integer
        tax:
          type: integer
        total:
          type: integer
        status:
          type: string
        paymentMethod:
          type: string
        createdAt:
          type: string
          format: date-time
    AppointmentLookup:
      type: object
      required:
        - id
      properties:
        id:
          type: string
    ContactCreate:
      type: object
      required:
        - name
        - email
        - phone
        - subject
        - message
      properties:
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        subject:
          type: string
        message:
          type: string
    ContactMessage:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        email:
          type: string
        phone:
          type: string
        subject:
          type: string
        message:
          type: string
        createdAt:
          type: string
          format: date-time
    ReservationBlock:
      type: object
      properties:
        id:
          type: string
        date:
          type: string
        time:
          type: string
        reason:
          type: string
        createdAt:
          type: string
          format: date-time
    PaymentIntentRequest:
      type: object
      required:
        - appointmentId
      properties:
        appointmentId:
          type: string
    PaymentIntent:
      type: object
      properties:
        intentId:
          type: string
        status:
          type: string
          example: created
        amount:
          type: integer
        currency:
          type: string
          example: CDF
        method:
          type: string
    AdminLogin:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        password:
          type: string
    AdminRegister:
      type: object
      required:
        - username
        - password
        - setupKey
      properties:
        username:
          type: string
        email:
          type: string
        password:
          type: string
        setupKey:
          type: string
    AdminAuthResponse:
      type: object
      properties:
        status:
          type: string
          example: ok
    AdminService:
      type: object
      required:
        - name
        - description
        - category
        - forAudience
      properties:
        name:
          type: string
        shortDescription:
          type: string
        description:
          type: string
        benefits:
          type: array
          items:
            type: string
        category:
          type: string
        forAudience:
          type: string
        slug:
          type: string
    ServiceTestimonial:
      type: object
      properties:
        id:
          type: string
        serviceId:
          type: string
        name:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        message:
          type: string
        createdAt:
          type: string
          format: date-time
    ServiceTestimonialCreate:
      type: object
      required:
        - name
        - rating
        - message
      properties:
        name:
          type: string
        rating:
          type: integer
          minimum: 1
          maximum: 5
        message:
          type: string
    AdminBlock:
      type: object
      required:
        - date
        - time
        - reason
      properties:
        date:
          type: string
          example: 2026-02-04
        time:
          type: string
          example: 09:00
        reason:
          type: string
    AdminStatus:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [booked, canceled]
    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        email:
          type: string
        role:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    AdminUserCreate:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
        email:
          type: string
        password:
          type: string
    AdminUserPassword:
      type: object
      required:
        - password
      properties:
        password:
          type: string
    Error:
      type: object
      properties:
        error:
          type: string
        details:
          type: object
          additionalProperties:
            type: string
